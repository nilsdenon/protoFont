<html>

<head>
    <link rel="stylesheet" href="<%=htmlWebpackPlugin.files.chunks.main.css %>">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
</head>

<body>
    <div class="fontblock" id="fontblock_1">
        <section class="fontblock__body">
            <div class="fontblock__headline">
                <div class="font-primary">
                    <div id="font_1_1" class='font font-primary'>
                        Lorem ipsum dolor sit amet
                    </div>
                    <span id="hud_1_1" class="hud hud--fontdetails hidden">
                        <dl>
                            <dt>Font Name</dt>
                            <dd>Font Size</dd>
                            <dd>Letter-Spacing</dd>
                            <dd>Line-Height</dd>
                        </dl>
                    </span>
                </div>
            </div>
            <div class="fontblock__bodytext">
                <div class="font-secondary">
                    <div id="font_1_2" class='font font-secondary'>
                            Lorem ipsum dolor sit amet
                        </div>
                </div>
                <span class="hud_1_2 hud--fontdetails hidden">
                    <dl>
                        <dt>Font Name</dt>
                        <dd>Font Size</dd>
                        <dd>Letter-Spacing</dd>
                        <dd>Line-Height</dd>
                    </dl>
                </span>
            </div>
        </section>
        <button onclick="toggleNav('fontblock_1'); this.classList.toggle('is-active')" class="burger">
            <div class="burger-box">
                <span class="burger-inner"></span>
            </div>
        </button>
        <aside class="fontblock__menu">
            
            <nav class="fontblock__nav">
                <form name="fontblock_form_1" class="fontblock__form" action="">
                    <div class="sep" id="subform__headline">
                        <legend>Headline</legend>
                        <div class="form-group">
                            <textarea class="custom-textarea" name="fontText_1_1" onkeyup="updateText('font_1_1', this.value);" placeholder="Lorem ipsum dolor sit amet" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">Lorem ipsum dolor sit amet</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Font-family</label>
                            <select class="form-control" name="fontSelect_1_1" id="fontSelect_1_1">
                            </select>
                        </div>
                    
                        <div class="form-group">
                            <label class="form-label">Font-size</label>
                            <input onchange="setFontSize('font_1_1', this.value);" on id="fontSize_1_1" class="form-control" name="fontSize_1_1" type="range" value="24" min="6" max="340" step="1" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Letter-Spacing</label>
                            <input onchange="setLetterSpacing('font_1_1', this.value);" on id="letterSpacing_1_1" class="form-control" name="letterSpacing_1_1" type="range" value="1" min="-50" max="150" step=".005" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Text Color</label>
                            <div class="input-group input-group-color">
                                <input class="form-control" onkeyup="setColor( 'font_1_1', 'headlineTextColor_1_1', this.value);" name="text-color" type="text" value="#4A4A4A">
                                <div class="input-group-prepend">
                                    <span id="headlineTextColor_1_1" class="color-box" ></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sep" id="subform__bodytext">
                        <legend>Body Text</legend>
                        <div class="form-group">
                            <textarea class="custom-textarea" name="fontText_1_2" onkeyup="updateText('font_1_2', this.value);" placeholder="Lorem ipsum dolor sit amet" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">Lorem ipsum dolor sit amet</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Font-family</label>
                            <select class="form-control" name="fontSelect_1_2" id="fontSelect_1_2">
                            </select>
                        </div>
                        <div class="form-group">
                                <label class="form-label" for="Font-size">Font-size</label>
                                <input onchange="setFontSize('font_1_2', this.value);" on id="fontSize_1_2" class="form-control" name="fontSize_1_2" type="range" value="24" min="6" max="340" step="1" />
                            </div>
                            <div class="form-group">
                                <label class="form-label">Letter-Spacing</label>
                                <input onchange="setLetterSpacing('font_1_2', this.value);" on id="letterSpacing_1_2" class="form-control" name="letterSpacing_1_2" type="range" value="1" min="-50" max="150" step=".005" />
                            </div>
                            <div class="form-group">
                                <label class="form-label">Text Color</label>
                                <div class="input-group input-group-color">
                                    <input class="form-control" onkeyup="setColor( 'font_1_2', 'bodyTextColor_1_2', this.value);" name="text-color" type="text" value="#FF3300">
                                    <div class="input-group-prepend">
                                        <span id="bodyTextColor_1_2" class="color-box" ></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <div class="sep" id="subform__general">
                        <div class="form-group">
                            <label class="form-label">FontBlock Color</label>
                            <div class="input-group input-group-color">
                                <input class="form-control" onkeyup="setBgColor( 'fontblock_1', 'fontblockColor_1', this.value);" name="text-color" type="text" value="#fff">
                                <div class="input-group-prepend">
                                    <span id="fontblockColor_1" class="color-box" ></span>
                                </div>
                            </div>
                         </div>
                        </div>
                  
                   <button onclick="saveChanges();" class="btn btn-primary btn-sm">
                       Save changes
                   </button>
                </form>
               
            </nav>
        </aside>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js"></script> 
    <script>
        "use strict";
        // Zuletzt gespeicherte Werte
        //loadSettings();
    
        function toggleNav(target) {
            var sel = document.querySelector('#' + target);
            sel.classList.toggle("is-open");
        }
        function updateText(el, text) {
           var target = document.getElementById(el);
           target.innerHTML = text;
        }
        
        function setFontSize(targetElement, size) {
            var target = document.getElementById(targetElement);
            target.style.fontSize = size + "px";
        }

        function setLetterSpacing(targetElement, value) {
            var target = document.getElementById(targetElement);
            target.style.letterSpacing = value + "px";
        }

        function setColor(textColor, colorBox, value) {
            var t1 = document.getElementById(textColor);
            var t2 = document.getElementById(colorBox);
            t1.style.color = value;
            t2.style.backgroundColor = value;
        }
        function setBgColor(BgColor, colorBox, value) {
            var t1 = document.getElementById(BgColor);
            var t2 = document.getElementById(colorBox);
            t1.style.backgroundColor = value;
            t2.style.backgroundColor = value;
        }
        // Webfonts aus externer JSON Datei laden (API)
        var apiKey = "key=AIzaSyBcJ0zfjh1BYgpDtpXDmigTl-53aojQ-Wc";
        var gf = "https://www.googleapis.com/webfonts/v1/webfonts?";
        var gwf = gf+apiKey;

        
        
        prepareFirstSelect();
        prepareSecondSelect();
        
        function prepareFirstSelect() {
            var request = new XMLHttpRequest();
            request.onload = function() {
            var jsonDoc = request.responseText;
            var jsonObject = JSON.parse(jsonDoc);
            var sel = document.querySelector("#fontSelect_1_1");
            // all items = all webfonts
            var fonts = jsonObject.items;
            
            // Erste Schleifte = alle Schriftfamilien holen
            for(var i=0; i<fonts.length; i++) {
                var families = fonts[i].family;
                var weights = fonts[i].variants;

                var optGrp = document.createElement("optgroup");
                optGrp.setAttribute("label", families);
                var opt = document.createElement("option");
                var t = document.createTextNode(families);
            
                // Zweite Schleife alle fontweights / Schnitte für eine Schriftfamilie holen
                for(var j=0; j<weights.length; j++) {
                    opt = document.createElement("option");
                    opt.setAttribute("data-weight", weights[j]);
                    // Setze Option Name als Familie + Schnitt als String
                    t = document.createTextNode((families + ' ' + weights[j]).toString());
                    // Setze aber Option Value nur die Familie, Schnitt wird in ein separates data Attribut gespeichert
                    var s = document.createTextNode(families);

                    // Italic muss auch aus dem Schnitt entfernt werden und als font-style definiert werden
                    if(weights[j].includes("italic")) {
                        opt.setAttribute("data-italic", true);
                    }
                    //w = document.createTextNode( weights[j].toString());
                    //t2 = document.createTextNode(weights[j]);
                    opt.setAttribute("value", families);
                    opt.appendChild(t);
                    optGrp.appendChild(opt);
                    //sconsole.log(t);
                }
                opt.appendChild(t);
                opt.setAttribute("value", families);
                optGrp.appendChild(opt);
                
                sel.appendChild(optGrp);
               
               // var families = jsonObject.items.family;
            }
          }
            request.open("GET", gwf, true);
            request.setRequestHeader("Accept", "application/json");
            request.send();  

        }
        // Ich konnte zwar in prepareFirstSelect() den dropdown zu Klonen aber leider funktioniert dann der eventListener für das geklonte Element nicht!
        function prepareSecondSelect() {
            var request = new XMLHttpRequest();
            request.onload = function() {
            var jsonDoc = request.responseText;
            var jsonObject = JSON.parse(jsonDoc);
            var sel = document.querySelector("#fontSelect_1_2");
            // all items = all webfonts
            var fonts = jsonObject.items;
            
            // Erste Schleifte = alle Schriftfamilien holen
            for(var i=0; i<fonts.length; i++) {
                var families = fonts[i].family;
                var weights = fonts[i].variants;

                var optGrp = document.createElement("optgroup");
                optGrp.setAttribute("label", families);
                var opt = document.createElement("option");
                var t = document.createTextNode(families);
            
                // Zweite Schleife alle fontweights / Schnitte für eine Schriftfamilie holen
                for(var j=0; j<weights.length; j++) {
                    opt = document.createElement("option");
                    opt.setAttribute("data-weight", weights[j]);
                    // Setze Option Name als Familie + Schnitt als String
                    t = document.createTextNode((families + ' ' + weights[j]).toString());
                    // Setze aber Option Value nur die Familie, Schnitt wird in ein separates data Attribut gespeichert
                    var s = document.createTextNode(families);

                    // Italic muss auch aus dem Schnitt entfernt werden und als font-style definiert werden
                    if(weights[j].includes("italic")) {
                        opt.setAttribute("data-italic", true);
                        // Iwort "italic" aus dem string entfernen und regular als default setzen wenn kein Schnitt vorhanden
                    }
                    //w = document.createTextNode( weights[j].toString());
                    //t2 = document.createTextNode(weights[j]);
                    opt.setAttribute("value", families);
                    opt.appendChild(t);
                    optGrp.appendChild(opt);
                    //sconsole.log(t);
                }
                opt.appendChild(t);
                opt.setAttribute("value", families);
                optGrp.appendChild(opt);
                
                sel.appendChild(optGrp);
               
               // var families = jsonObject.items.family;
            }
          }
            request.open("GET", gwf, true);
            request.setRequestHeader("Accept", "application/json");
            request.send();  

        }
        
        // Schrift aus dem Select Aktualisieren
        function updateFont(targetElement, targetSelect) {
            var target = document.getElementById(targetElement);
            var selector = document.querySelector('#'+targetSelect);
            var value = selector[selector.selectedIndex].value;
            var dataWeight = selector[selector.selectedIndex].getAttribute('data-weight');
            // String muss in einführungszeichen ausgegeben werden
            var valueInQuotes =  "'" + value + "'";
            // Schrift Familie setzen
            target.style.fontFamily = valueInQuotes;
            // Font-weight vorhab leeren sonst bekommt das neue index der svorher gesetzte Wert
            target.style.fontWeight = "";
            // Font-weight / Schriftschnitte setzen aus dem data-weight Attribut
            target.style.fontWeight = dataWeight;   
            // Setzte italic font-style wenn vorhanden
            if(dataWeight.includes("italic")) {
                target.style.fontStyle = "italic";
            } else {
                target.style.fontStyle = "";
            }
            // Schrift Dynamisch laden
            // Variable value im JSON Object pushen
            
            // laut viele posts ist es nicht gestattet in JavaScript Webfonts dynamisch nachzuladen, hier gibt es aber eine Lösung: https://codepen.io/hbrok/pen/rrBRmj oder auch hier aus einem Pulldown http://jsfiddle.net/zejz2tkp/1/

             /*var wfl = {
                google: { 
                        families: []
                } 
            };
            wfl.google.families = value;
            
            WebFont.load(wfl); 
            console.log(wfl); */
            // webfont loader doku: https://github.com/typekit/webfontloader
            // TO DO Schriftschnitten müssen in der FVD Notierung Konvertiert werden: https://github.com/typekit/fvd
            var loadFont = function(font) {
                WebFont.load({
                    google: {
                        families: [font]
                    }
                });
            }
            loadFont(value);
            localStorage.setItem("Font-Family", value);
        }
        
        
        // Änderungen dynamisch in localStorage als JSON Objekt speichern
        //saveChanges();
        var form = document.forms["fontblock_form_1"];
        var formElements = form.elements;

        function saveChanges() {
            
            // Font 1_1 Text Element
            localStorage.setItem("font_1_1", formElements.fontText_1_1.value);
            // font 1_1 Textarea
           
            // fontSelect_1_1
            localStorage.setItem("fontSelect_1_1", formElements.fontSelect_1_1.value);
            // TO DO: Font Select 1_1 font-weight
           
            // fontSelect_1_1 fontSite
            localStorage.setItem("fontSize_1_1", formElements.fontSize_1_1.value);
            /*for(var i=0; i<formElements.length; i++) {
                //console.log("Element " + i + " :" + formElements[i].value + " " + formElements[i].type + "<br>");
                var test = localStorage.setItem("element-"+i, formElements[i].value);
                console.log(test);
            }*/
            //localStorage.setItem("settings", value);
        }
        // Änderungen dynamisch laden
        
        document.addEventListener('DOMContentLoaded', function() {
            /* es müssen folgende Dinge Passieren beim Neuladen der Seite:
                1. wenn ich ein Formular Element änderen muss der Werte in localStorage gespeichert werden
                2. Text muss aktualisiert werden
                3. alle styles müssen aktualisiert werden
                4. die im select Elemente passendes Webfonts müssen mit Hilfe vom webFontLoader geladen werden
            */

            //var ls_fontText_1_1 = localStorage.getItem("fontText_1_1");
           // formElements.fontText_1_1.value = ls_fontText_1_1.value;
            //var storage = localStorage.getItem("Font-Family");
            var ls_fontText_1_1 = localStorage.getItem("fontText_1_1");
            formElements.fontText_1_1.value = ls_fontText_1_1.value;

            var ls_fontSelect_1_1 = localStorage.getItem("fontSelect_1_1");
            formElements.fontSelect_1_1.value = ls_fontSelect_1_1.value; 
            var loadFont = function(font) {
                WebFont.load({
                    google: {
                        families: [font]
                    }
                });
            }
            loadFont(ls_fontSelect_1_1);
            var ls_fontSize_1_1 = localStorage.getItem("fontSize_1_1");
            formElements.fontSize_1_1.value = ls_fontSize_1_1.value;

            var f1 = document.querySelector("#font_1_1");
            f1.style.fontFamily = ls_fontSelect_1_1;
            f1.style.fontSize = ls_fontSize_1_1;
            //console.log(localStorage.getItem("fontSelect_1_1"));
            console.log(el_fontSize_1_1.value);
        });

        // EventListeners form Elemente
        var select1 = document.querySelector("#fontSelect_1_1");
        var select2 = document.querySelector("#fontSelect_1_2");

        var el_fontSize_1_1 = formElements.fontSize_1_1;
        el_fontSize_1_1.addEventListener("change", function(){
            saveChanges();
            console.log(el_fontSize_1_1.value);
        });

        select1.addEventListener("change", function(){
            updateFont('font_1_1', 'fontSelect_1_1');
            saveChanges();
        });

        select2.addEventListener("change", function(){
            updateFont('font_1_2', 'fontSelect_1_2');
        });
        formElements.fontText_1_1.addEventListener("keyup", function() {
            saveChanges();
        });
    </script>
   
    <script src="<%= htmlWebpackPlugin.files.chunks.main.entry %>"></script>

</body>

</html>